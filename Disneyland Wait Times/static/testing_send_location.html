<!DOCTYPE html>
<html>
<head>
    <title>Send Location</title>
    <script>
        function sendLocation(useGeolocation = true) { // Add parameter to control geolocation
            let latitude, longitude;

            if (useGeolocation && navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        latitude = position.coords.latitude;
                        longitude = position.coords.longitude;
                        sendLocationToServer(latitude, longitude); // Call function to send
                    },
                    error => {
                        console.error("Geolocation error:", error);
                        alert("Could not get location. Using test coordinates.");
                        latitude = 33.8121; // Disneyland test coordinates
                        longitude = -117.9190;
                        sendLocationToServer(latitude, longitude); // Call function to send with test coordinates
                    }
                );
            } else { // Use test coordinates if geolocation is disabled or not available
                latitude = 33.8121; // Disneyland test coordinates
                longitude = -117.9190;
                sendLocationToServer(latitude, longitude); // Call function to send with test coordinates
            }
        }

        function sendLocationToServer(latitude, longitude) { // Separate function for sending
           fetch("[YOUR IP HERE]:5000/location", { // Your Flask server URL
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ latitude: latitude, longitude: longitude })
            })
            .then(response => {
                if (!response.ok) { // Check for HTTP errors (4xx or 5xx)
                    return response.json().then(err => {throw new Error(err.error || 'Server Error')}); // Throw error with message
                }
                return response.json(); // If response is ok, parse the JSON
            })
            .then(data => {
                console.log("Server Response:", data);
                if (data.status === "inside Disneyland") {
                    alert("You're at Disneyland!");
                } else if (data.status === "outside Disneyland") {
                    alert("You're not at Disneyland.");
                } else if (data.error) { // Check for error messages from the server
                    alert("Error: " + data.error);
                } else {
                    alert("Unexpected response from server: " + JSON.stringify(data)); // Catch-all for unexpected data
                }
            })
            .catch(error => {
                console.error("Error with fetch request:", error);
                alert("Error: " + error.message); // Show error message to user
            });
        }
    </script>
</head>
<body>
    <h2>Send Your Location</h2>
    <button onclick="sendLocation()">Send Location (Geolocation)</button>
    <button onclick="sendLocation(false)">Send Location (Test Coordinates)</button> </body>
</html>
</html>
